#!/usr/bin/env perl
use strict;
use warnings;
use feature qw(say switch);
use Cwd;
use Git;
use Getopt::Long;
$|++;

my ($action, $hotfix_prefix,$hotfix_name, $branch_off, $branch_name);
   
($action,$hotfix_name,$branch_off) = @ARGV;

die 'action required' unless $action;


# my $version = Git::command_oneline('version');
my $working_dir = getcwd();
my $repo = Git->repository ( WorkingSubdir => $working_dir );


$branch_off ||= 'master';
$hotfix_prefix ||= $repo->config('release.hotfix-prefix') || 'hotfix-';
$branch_name = $hotfix_prefix . $hotfix_name;

given( $action ) {
    when ( 'new' ) { 
        say "Creating branch $branch_name from $branch_off";
        $repo->command( 'checkout' , '-b' , $branch_name , $branch_off );
        say "Done";
    }
}

__END__
=pod

To create a hotfix branch from master, for ticket 13033:

    git hotfix new bug0001

Or

    git hotfix new bug0001 master

should work.

=cut
